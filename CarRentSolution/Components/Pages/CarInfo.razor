@page "/auto"
@page "/auto/{Vin}/{IsView:bool}"
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization

<PageTitle>Информация об авто</PageTitle>
@attribute [Authorize("StaffOnly")]

<div class="page-container">
    @if (_isLoaded)
    {
        <h3 class="mb-4">
            @(_isView ? "Просмотр авто" : "Редактирование авто")
        </h3>
        <div class="order-card">
            <h4 class="card-title">Общие данные</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr;grid-gap: 10px">
                <div>
                    @if (_auto.Photo != null)
                    {
                        <img class="img-car" src="data:image/jpg;base64,@_auto.Photo"/>
                    }
                    else
                    {
                        <img class="img-car"
                            src="empty.png"/>
                    }
                    @if (!_isView)
                    {
                        <div class="form-group">
                            <label>Фото</label>
                            <InputFile
                                class="form-control"
                                OnChange="LoadImg"
                                accept=".jpg"/>
                        </div>
                    }
                </div>
                <div>
                    <div class="form-group">
                        <label for="vin">VIN</label>
                        <input
                            disabled="@_isView"
                            type="text"
                            class="form-control"
                            required
                            maxlength="17"
                            @bind="_auto.Vin"/>
                    </div>

                    <div class="form-group">
                        <label for="year">Год</label>
                        <input
                            disabled="@_isView"
                            type="number"
                            class="form-control"
                            required
                            maxlength="4"
                            @bind="_auto.Year"/>
                    </div>

                    <div class="form-group">
                        <label for="engine">Двигатель</label>
                        <input
                            disabled="@_isView"
                            type="text"
                            class="form-control"
                            required
                            maxlength="17"
                            @bind="_auto.Engine"/>
                    </div>

                    <div class="form-group">
                        <label for="body">Кузов</label>
                        <input
                            disabled="@_isView"
                            type="text"
                            class="form-control"
                            required
                            maxlength="17"
                            @bind="_auto.Body"/>
                    </div>

                    <div class="form-group">
                        <label for="color">Цвет</label>
                        <input
                            disabled="@_isView"
                            type="text"
                            class="form-control"
                            required
                            @bind="_auto.Color"/>
                    </div>

                    <div class="form-group">
                        <label for="full_price">Полная стоимость</label>
                        <input
                            disabled="@_isView"
                            type="number"
                            class="form-control"
                            required
                            @bind="_auto.FullPrice"/>
                    </div>

                    <div class="form-group">
                        <label for="rent_price">Стоимость аренды (1 сутки)</label>
                        <input
                            disabled="@_isView"
                            type="number"
                            class="form-control"
                            required
                            @bind="_auto.RentPrice"/>
                    </div>

                    <div class="form-group">
                        <label for="model">Модель</label>
                        <select
                            @bind="_auto.ModelId"
                            disabled="@_isView"
                            name="model"
                            class="form-control">
                            @foreach (var model in _models)
                            {
                                <option value="@model.Id">@model.Name (@model.Brand.Name)</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="order-card">
            <h4 class="card-title">Данные ПТС</h4>

            <div
                class="form-group">
                <label for="number">Гос номер</label>
                <input
                    disabled="@_isView"
                    type="text"
                    class="form-control"
                    @bind="_auto.GovNumber"/>
            </div>

            <div
                class="form-group">
                <label for="passport">Номер ПТС</label>
                <input
                    disabled="@_isView"
                    type="text"
                    class="form-control"
                    required
                    @bind="_auto.Passport"/>
            </div>

            <div
                class="form-group">
                <label for="date">Дата выдачи</label>
                <input
                    disabled="@_isView"
                    type="date"
                    class="form-control"
                    required
                    @bind="_auto.PassportDated"/>
            </div>

            <div
                class="form-group">
                <label for="issued">Кем выдан</label>
                <input
                    disabled="@_isView"
                    type="text"
                    class="form-control"
                    required
                    @bind="_auto.PassportIssued"/>
            </div>

            @if (!_isView)
            {
                <AuthorizeView Policy="AdminOnly">
                    <label style="color: @_message.Color">@_message.Message</label>
                    <div class="form-group">
                        <button
                            @onclick="Save"
                            type="button"
                            class="btn btn-primary"
                            style="width: 100%; margin-top: 5px">Сохранить
                        </button>
                    </div>
                </AuthorizeView>
            }

            <AuthorizeView Policy="AdminOnly">
                @if (_isView)
                {
                    <div class="form-group">
                        <a
                            class="btn btn-primary"
                            style="width: 100%; margin-top: 5px"
                            href="auto/@Vin/false">Редактировать</a></div>
                }
            </AuthorizeView>
        </div>
    }
    else
    {
        <h5>Загрузка...</h5>
    }
</div>